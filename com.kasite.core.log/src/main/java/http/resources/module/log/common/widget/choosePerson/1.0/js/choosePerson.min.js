function choosePerson(a){choosePerson.opts=$.extend(true,{},choosePerson.defaults,a);choosePerson.init()}choosePerson.defaults={parmOrgData:{},artDialogTitle:"\u8bf7\u9009\u62e9",initDataId:null,initDataName:null,initDataParent:null,ztreeJsonUrl:"",searchJsonUrl:"",selectNumber:15,selectTips:false,selectPrompt:"\u6700\u591a\u53ea\u80fd\u9009\u62e9\uff1a",async:false,ztreeFun:{Check:null,AsyncSuccess:null,Click:null},callBack:null,searchShow:true,selectAllBtn:true,colseImgSrc:"../widget/zTree/3.5.18/images/del.png",searchPlaceholder:"\u641c\u7d22\u90e8\u95e8\u4eba\u540d",selectTitle:"\u9009\u62e9\u4eba\u5458\u4fe1\u606f",rootNodeSelect:false,searchDataKey:{ORGNAME:"ORGNAME",CNAME:"CNAME",USERID:"USERID"}};choosePerson.init=function(){choosePerson.initHtmlWrap();choosePerson.artDialog.init();choosePerson.ztreeFun=choosePerson.opts.ztreeFun;choosePerson.ztree(choosePerson.ztreeSetting());choosePerson.search();if(choosePerson.opts.initDataId!=null&&choosePerson.opts.initDataName!=null&&choosePerson.opts.initDataParent!=null){choosePerson.createInitPerson(choosePerson.opts.initDataId,choosePerson.opts.initDataName,choosePerson.opts.initDataParent)}};choosePerson.ztreeSetting=function(){var callbackFun={onCheck:function(event,treeId,treeNode){if(choosePerson.ztreeFun.Check){eval("choosePerson.ztreeFun.Check(event,treeId, treeNode)")}else{eval("choosePerson.ztreeOnCheck(event,treeId, treeNode)")}},onAsyncSuccess:function(event,treeId,treeNode,msg){$("#ztreeLoadingTips").hide();if(choosePerson.ztreeFun.AsyncSuccess){eval("choosePerson.ztreeFun.AsyncSuccess(event,treeId, treeNode, msg)")}else{eval("choosePerson.ztreeOnAsyncSuccess(event,treeId, treeNode, msg)")}},beforeClick:function(treeId,treeNode){var zTree=$.fn.zTree.getZTreeObj("choosePersonTree");if(treeNode.isParent){if(zTree.expandNode(treeNode)){$("#selectBtn"+treeNode.tId).css({display:"inline-block"})}else{$("#selectBtn"+treeNode.tId).css({display:"none"})}}else{choosePerson.createOnePerson(treeNode)}if(!choosePerson.initClick){choosePerson.initClick=true;if(choosePerson.ztreeFun.Click){eval("choosePerson.ztreeFun.Click(treeId, treeNode)")}else{eval("choosePerson.ztreeOnClick(treeId, treeNode)")}}return false},beforeCollapse:function(treeId,treeNode){var zTree=$.fn.zTree.getZTreeObj("choosePersonTree");if(treeNode.isParent){if(!zTree.expandNode(treeNode)){$("#selectBtn"+treeNode.tId).css({display:"none"})}}return false},beforeExpand:function(treeId,treeNode){var zTree=$.fn.zTree.getZTreeObj("choosePersonTree");if(treeNode.isParent){if(zTree.expandNode(treeNode)){$("#selectBtn"+treeNode.tId).css({display:"inline-block"})}}return false}};if(choosePerson.opts.async){var _ztreeSettingVal={async:{enable:true,url:choosePerson.opts.ztreeJsonUrl,autoParam:["id"],otherParam:choosePerson.opts.parmOrgData,dataFilter:choosePerson.ztreeFilter,type:"post"},view:{selectedMulti:false,showIcon:choosePerson.showIconForTree,showTitle:false,dblClickExpand:false,showLine:false,addDiyDom:choosePerson.addDiyDom},callback:callbackFun}}else{var _ztreeSettingVal={view:{selectedMulti:false,showIcon:choosePerson.showIconForTree,showTitle:false,dblClickExpand:false,showLine:false,addDiyDom:choosePerson.addDiyDom},callback:callbackFun}}return _ztreeSettingVal};choosePerson.showIconForTree=function(b,a){return a.isParent};choosePerson.addDiyDom=function(c,b){if(b.isParent&&choosePerson.opts.selectAllBtn){if(!choosePerson.opts.rootNodeSelect&&b.level==0){return false}var e=$("#"+b.tId+"_a");var d='<a href="javascript:;" id="selectBtn'+b.tId+'">\u9009\u62e9</a>';e.append(d);var a=$("#selectBtn"+b.tId);a.css({display:"none",color:"#4fc1e9","line-height":"2.25","margin-left":"15px"}).on("click",function(f){f.stopPropagation();f.preventDefault();choosePerson.clickDomBtn(b)});if(b.open){a.css({display:"inline-block"})}return false}};choosePerson.clickDomBtn=function(a){choosePerson.createOnePerson(a)};choosePerson.ztreeOnCheck=function(a,c,b){};choosePerson.ztreeOnAsyncSuccess=function(a,c,b,d){};choosePerson.ztreeOnClick=function(b,a){};choosePerson.ztreeFilter=function(c,a,b){return b};choosePerson.ztree=function(a){if(choosePerson.opts.async){$.fn.zTree.init($("#choosePersonTree"),a)}else{choosePerson.ztreeNodes(a)}};choosePerson.ztreeNodes=function(a){$.ajax({dataType:"json",type:"POST",data:choosePerson.opts.parmOrgData,cache:false,url:choosePerson.opts.ztreeJsonUrl,success:function(b){$.fn.zTree.init($("#choosePersonTree"),a,b);$("#ztreeLoadingTips").hide()}})};choosePerson.createInitPerson=function(h,b,f){if(!(h&&h!="")){$("#choosePerson-selecteBox").html("");return}var e="",c=h.split(","),a=b.split(","),g=f.split(",");for(var d=0;d<c.length;d++){e+=choosePerson.createPerson(c[d],a[d],g[d])}$("#choosePerson-selecteBox").html(e)};choosePerson.judgeSelectPerson=function(d){if($("#choosePerson-selecteBox>li").length>=choosePerson.opts.selectNumber){choosePerson.orerunDialog();return false}else{var a=true;for(var c=0;c<$("#choosePerson-selecteBox>li").length;c++){if(d==$("#choosePerson-selecteBox>li").eq(c).data("id")){a=false}}return a}};choosePerson.createOnePerson=function(b){if(choosePerson.judgeSelectPerson(b.id)){var a=choosePerson.createPerson(b.id,b.name,b.isParent);$("#choosePerson-selecteBox").append(a)}};choosePerson.createPerson=function(e,a,c){var d="";if((typeof(c)=="boolean"&&c)||(typeof(c)=="string"&&c==="true")){d='<i class="mr5" style="width: 16px; height: 16px; display: inline-block; background: url(../widget/zTree/3.5.18/images/diy/file.png) no-repeat center; position: relative; top: 2px;"></i>'}var b='<li class="clearfix c-line-h2" data-parent="'+c+'" data-name="'+a+'" data-id="'+e+'"><div class="fl">'+d+" "+a+'</div> <div class="fr"><a href="javascript:;" onclick="choosePerson.delPerson(this)" class="alinks alinks-black"><img src="'+choosePerson.opts.colseImgSrc+'" /></a> </div></li>';return b};choosePerson.delPerson=function(a){$(a).parents("li").remove()};choosePerson.orerunDialog=function(){art.dialog({lock:true,artIcon:"error",opacity:0.4,width:250,title:"报错",content:choosePerson.opts.selectPrompt+choosePerson.opts.selectNumber,ok:function(){}})};choosePerson.makeAllPerson=function(){var b={id:"",name:"",parent:""},c=$("#choosePerson-selecteBox>li");for(var a=0;a<c.length;a++){b.id+=c.eq(a).data("id")+",";b.name+=c.eq(a).data("name")+",";b.parent+=c.eq(a).data("parent")+","}b.id=b.id.substring(0,b.id.length-1);b.name=b.name.substring(0,b.name.length-1);b.parent=b.parent.substring(0,b.parent.length-1);return b};choosePerson.search=function(){$("#choosePerson-dialog").on("focus",".list-search-input",function(){$(this).parent().find(".list-search-clear").show();if(!$(this).parent().next(".search-overlay").is(":visible")){$(this).parent().next(".search-overlay").show()}}).on("blur",".list-search-input",function(){var $this=$(this);if($this.val()==""&&$("#choosePerson-searchTbody>tr").length<=0){$this.parent().find(".list-search-clear").hide();$(this).parent().next(".search-overlay").hide()}}).on("keyup",".list-search-input",function(e){var ev=document.all?window.event:e;if(ev.keyCode==13){searchAjax($("#choosePerson-dialog").find("input.list-search-input"))}});$("#choosePerson-dialog").on("click",".list-search-icon",function(){searchAjax($("#choosePerson-dialog").find("input.list-search-input"))});function searchAjax(dom){var _val=$.trim(dom.val());if(_val==""){return false}choosePerson.opts.parmOrgData.userName=_val;$.ajax({dataType:"json",type:"POST",data:choosePerson.opts.parmOrgData,cache:false,url:choosePerson.opts.searchJsonUrl,success:function(data){var Html="";for(var i=0;i<data.Result.length;i++){var _USERID=eval("data.Result[i]."+choosePerson.opts.searchDataKey.USERID),_CNAME=eval("data.Result[i]."+choosePerson.opts.searchDataKey.CNAME),_ORGNAME=eval("data.Result[i]."+choosePerson.opts.searchDataKey.ORGNAME);Html+='<tr data-parent="false" data-name="'+_CNAME+'" data-id="'+_USERID+'"><td class="c-t-center"><span class="c-nowrap">'+_CNAME+'</span></td><td><span class="c-nowrap">'+_ORGNAME+"</span></td></tr>"}$("#choosePerson-searchTbody").html(Html)}})}$("#choosePerson-searchTbody").on("click","tr",function(){var _id=$(this).data("id"),_name=$(this).data("name"),_parent=$(this).data("parent"),_listHtml="";if(choosePerson.judgeSelectPerson(_id)){_listHtml=choosePerson.createPerson(_id,_name,_parent);$("#choosePerson-selecteBox").append(_listHtml)}});$("#choosePerson-dialog").on("click",".list-search-clear",function(){$(this).parent().find("input.list-search-input").val("").blur();$(this).hide().parent().next(".search-overlay").hide();$("#choosePerson-searchTbody>tr").off();$("#choosePerson-searchTbody").html("")})};choosePerson.htmlWrap='<div class="c-main clearfix c-hide" id="choosePerson-dialog"><div class="fl w350 h350 c-border c-hidden"><div class="c-position-r c-border-b" id="searchShow"><div class="c-666 ptb10 plr15 c-line-h1"><input type="text" id="searchPlaceholder" placeholder="" class="width-90 c-f14 list-search-input"><i class="iconfont c-position-a c-position-rt10 mr30 c-cursor-p c-hide list-search-clear" title="清空">&#xe635;</i><i class="iconfont c-position-a c-position-rt10 c-cursor-p list-search-icon" title="搜索">&#xe62c;</i></div><div class="bgc-fff c-position-a width-100 c-border-t c-hide search-overlay" style="height: 360px; overflow: auto"><table class="tb width-100 c-t-center c-position-r" data-toggle="tbHover" style="top: -1px"><thead><tr><th>姓名</th><th>组织名称</th></tr></thead><tbody id="choosePerson-searchTbody"></tbody></table></div></div><div class="bgc-fdfdfd" id="ztreeWrap" style="height: 360px; overflow: auto"><div class="pt100 c-t-center c-909090 c-f14" id="ztreeLoadingTips">数据正在加载中。。。</div><div class="p10"><ul id="choosePersonTree" class="ztree ztree-slack ztree-solid-arrow"></ul></div></div></div><div class="fr w350 h350 c-border c-hidden"><div class="plr15 ptb10 c-f14 c-666 c-border-b" id="selectTitle"></div><div class="bgc-fdfdfd" style="height:360px; overflow:auto;"><div class="p10"><ul class="c-666" id="choosePerson-selecteBox"></ul></div></div></div></div>';choosePerson.artDialog={init:function(){this.obj=art.dialog({artIcon:"add",lock:true,opacity:0.4,width:780,padding:"15px 25px",title:choosePerson.opts.artDialogTitle,content:$("#choosePerson-dialog").get(0),ok:function(){if(choosePerson.opts.callBack){var a=choosePerson.makeAllPerson();choosePerson.opts.callBack(a.id,a.name,a.parent)}choosePerson.dialogClose()},cancel:function(){choosePerson.dialogClose()}})},obj:null};choosePerson.dialogClose=function(){choosePerson.removeHtmlWrap()};choosePerson.initHtmlWrap=function(){choosePerson.removeHtmlWrap();$("body").append(this.htmlWrap);$("#selectTitle").html(choosePerson.opts.selectTitle);$("#searchPlaceholder").attr("placeholder",choosePerson.opts.searchPlaceholder);if(!choosePerson.opts.searchShow){$("#searchShow").hide();$("#ztreeWrap").height("400px")}};choosePerson.removeHtmlWrap=function(){if($("#choosePerson-dialog").length){$("#choosePerson-dialog").remove()}};