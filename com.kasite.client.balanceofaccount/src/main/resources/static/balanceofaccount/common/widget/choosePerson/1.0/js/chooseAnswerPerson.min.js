var chooseAnswerPerson=function(a){chooseAnswerPerson.init(a)};chooseAnswerPerson.defaults={htmlId:"",parmOrgData:{},artDialogTitle:"\u8bf7\u9009\u62e9\u8d1f\u8d23\u4eba",initDataId:null,initDataName:null,ztreeJsonUrl:"",searchJsonUrl:"",checkType:1,selectNumber:10,selectPrompt:"\u6700\u591a\u53ea\u80fd\u9009\u62e9\u0031\u0030\u4e2a\u4eba\uff01",async:false,ztreeFun:{Check:null,AsyncSuccess:null,Click:null},callBack:null};chooseAnswerPerson.init=function(a){chooseAnswerPerson.opts=$.extend(this.defaults,a||{});chooseAnswerPerson.initHtmlWrap();chooseAnswerPerson.artDialog.init();chooseAnswerPerson.search();chooseAnswerPerson.ztreeFun=chooseAnswerPerson.opts.ztreeFun;chooseAnswerPerson.ztree(chooseAnswerPerson.ztreeSetting())};chooseAnswerPerson.ztree=function(a){if(chooseAnswerPerson.opts.async){$.fn.zTree.init($("#chooseAnswerPersonTree"),a)}else{chooseAnswerPerson.ztreeNodes(a)}};chooseAnswerPerson.ztreeNodes=function(a){$.ajax({dataType:"json",type:"POST",data:chooseAnswerPerson.opts.parmOrgData,cache:false,url:chooseAnswerPerson.opts.ztreeJsonUrl,success:function(b){$.fn.zTree.init($("#chooseAnswerPersonTree"),a,b);$("#ztreeAnswerLoadingTips").hide();chooseAnswerPerson.ztreeCheckNode(chooseAnswerPerson.opts.initDataId)}})};chooseAnswerPerson.ztreeOnCheck=function(a,c,b){};chooseAnswerPerson.ztreeOnAsyncSuccess=function(a,c,b,d){$("#ztreeAnswerLoadingTips").hide();chooseAnswerPerson.ztreeCheckNode(chooseAnswerPerson.opts.initDataId)};chooseAnswerPerson.ztreeOnClick=function(a,c,b,d){};chooseAnswerPerson.ztreeFilter=function(c,a,b){return b};chooseAnswerPerson.ztreeCheckNode=function(c){if(c&&c!=""){var b=$.fn.zTree.getZTreeObj("chooseAnswerPersonTree");var d=b.transformToArray(b.getNodes()[0].children);if(c.indexOf(",")>0){c=c.split(",");for(var a=0;a<d.length;a++){$(c).each(function(f,e){if(e==d[a].id){b.checkNode(d[a],true,true)}})}}else{for(var a=0;a<d.length;a++){if(c==d[a].id){b.checkNode(d[a],true,true)}}}}};chooseAnswerPerson.ztreeSetting=function(){var callbackFun={onCheck:function onCheck(event,treeId,treeNode){if(chooseAnswerPerson.ztreeFun.Check){eval("chooseAnswerPerson.ztreeFun.Check(event,treeId, treeNode)")}else{eval("chooseAnswerPerson.ztreeOnCheck(event,treeId, treeNode)")}},onAsyncSuccess:function onAsyncSuccess(event,treeId,treeNode,msg){if(chooseAnswerPerson.ztreeFun.AsyncSuccess){eval("chooseAnswerPerson.ztreeFun.AsyncSuccess(event,treeId, treeNode, msg)")}else{eval("chooseAnswerPerson.ztreeOnAsyncSuccess(event,treeId, treeNode, msg)")}},onClick:function onClick(event,treeId,treeNode,msg){if(chooseAnswerPerson.ztreeFun.Click){eval("chooseAnswerPerson.ztreeFun.Click(event,treeId, treeNode, msg)")}else{eval("chooseAnswerPerson.ztreeOnClick(event,treeId, treeNode, msg)")}}};if(chooseAnswerPerson.opts.async){if(chooseAnswerPerson.opts.checkType==1){var _ztreeSettingVal={async:{enable:true,url:chooseAnswerPerson.opts.ztreeJsonUrl,autoParam:["id"],otherParam:chooseAnswerPerson.opts.parmOrgData,dataFilter:chooseAnswerPerson.ztreeFilter,type:"post"},check:{enable:true,chkStyle:"radio",radioType:"all"},callback:callbackFun}}else{if(chooseAnswerPerson.opts.checkType==2){var _ztreeSettingVal={async:{enable:true,url:chooseAnswerPerson.opts.ztreeJsonUrl,autoParam:["id"],otherParam:chooseAnswerPerson.opts.parmOrgData,dataFilter:chooseAnswerPerson.ztreeFilter,type:"post"},check:{enable:true},callback:callbackFun}}else{var _ztreeSettingVal={async:{enable:true,url:chooseAnswerPerson.opts.ztreeJsonUrl,autoParam:["id"],otherParam:chooseAnswerPerson.opts.parmOrgData,dataFilter:chooseAnswerPerson.ztreeFilter,type:"post"},callback:callbackFun}}}}else{if(chooseAnswerPerson.opts.checkType==1){var _ztreeSettingVal={check:{enable:true,chkStyle:"radio",radioType:"all"},callback:callbackFun}}else{if(chooseAnswerPerson.opts.checkType==2){var _ztreeSettingVal={check:{enable:true},callback:callbackFun}}else{var _ztreeSettingVal={callback:callbackFun}}}}return _ztreeSettingVal};chooseAnswerPerson.search=function(){$("#popRespChoo").on("focus",".list-search-input",function(){$(this).parent().find(".list-search-clear").show();if(!$(this).parent().next(".search-overlay").is(":visible")){$(this).parent().next(".search-overlay").show()}}).on("blur",".list-search-input",function(){var b=$(this);if(b.val()==""&&$("#personSearchTbody>tr").length<=0){b.parent().find(".list-search-clear").hide();$(this).parent().next(".search-overlay").hide()}}).on("keyup",".list-search-input",function(c){var b=document.all?window.event:c;if(b.keyCode==13){a($("#popRespChoo").find("input.list-search-input"))}});$("#popRespChoo").on("click",".list-search-icon",function(){a($("#popRespChoo").find("input.list-search-input"))});function a(b){var c=$.trim(b.val());if(c==""){return false}chooseAnswerPerson.opts.parmOrgData.userName=c;$.ajax({dataType:"json",type:"POST",data:chooseAnswerPerson.opts.parmOrgData,cache:false,url:chooseAnswerPerson.opts.searchJsonUrl,success:function(f){var d="";for(var e=0;e<f.Result.length;e++){if(chooseAnswerPerson.opts.checkType==1){d+='<tr><td><label><input type="radio" class="radio person-search-radio" data-name="'+f.Result[e].CNAME+'" data-rid="'+f.Result[e].USERID+'"></label></td><td class="c-t-center"><span class="c-nowrap">'+f.Result[e].CNAME+'</span></td><td><span class="c-nowrap">'+f.Result[e].JOBNUMBER+'</span></td><td><span class="c-nowrap">'+f.Result[e].ORGNAME+"</span></td></tr>"}else{d+='<tr><td><label><input type="checkbox" class="checkbox person-search-checkbox" data-name="'+f.Result[e].CNAME+'" data-rid="'+f.Result[e].USERID+'"></label></td><td class="c-t-center"><span class="c-nowrap">'+f.Result[e].CNAME+'</span></td><td><span class="c-nowrap">'+f.Result[e].JOBNUMBER+'</span></td><td><span class="c-nowrap">'+f.Result[e].ORGNAME+"</span></td></tr>"}}$("#personSearchTbody").html(d)}})}$("#popRespChoo").on("click",".list-search-clear",function(){$(this).parent().find("input.list-search-input").val("").blur();$(this).parent().next(".search-overlay").hide();$("#personSearchTbody").html("")});if(chooseAnswerPerson.opts.checkType==1){$("#personSearchCheckboxAll").parent().hide();$("#popRespChoo").on("click",".person-search-radio",function(){$(this).parents("tr").siblings().find(".person-search-radio").prop({checked:false})})}else{$("#popRespChoo").on("click","#personSearchCheckboxAll",function(){if($(this).is(":checked")){$("#personSearchTbody").find('input[type="checkbox"]').attr("checked","true")}else{$("#personSearchTbody").find('input[type="checkbox"]').removeAttr("checked")}});$("#popRespChoo").on("click",".person-search-checkbox",function(){var b=true;$(".person-search-checkbox").each(function(){if(!($(this).is(":checked"))){$("#personSearchCheckboxAll").removeAttr("checked");b=false}});if(b){$("#personSearchCheckboxAll").attr("checked","true")}})}};chooseAnswerPerson.htmlWrap='<div id="popRespChoo" style="display:none;"><div class="c-main"><div class="w420 bgc-fff"><div class="c-border list"><div class="plr15 ptb10 c-f14 c-666 c-position-r c-border-b"><div class="list-search c-position-r searchuser"><input type="text" placeholder="搜索部门人名" class="list-search-input"><i class="iconfont list-search-clear c-hide" title="清空">&#xe635;</i><i class="iconfont list-search-icon" title="搜索">&#xe62c;</i></div><div class="search-overlay"><div class=""><table class="tb width-100 c-t-center"><thead><tr><th><label><input type="checkbox" class="checkbox" id="personSearchCheckboxAll"></label></th><th>姓名</th><th>工号</th><th>组织名称</th></tr></thead><tbody id="personSearchTbody"></tbody></table></div></div></div><div class="ptb10" style="height:280px; overflow:auto;"><div class="pt100 c-t-center c-909090 c-f14" id="ztreeAnswerLoadingTips">数据正在加载中。。。</div><ul id="chooseAnswerPersonTree" class="ztree ztree-slack ztree-solid-arrow"></ul></div></div></div></div></div>';chooseAnswerPerson.makeArray=function(b,a,c){var d=true;if(c.length>0){$(c).each(function(g,f){if(b==f.rid){d=false}})}if(d){var e=new Array();e.rid=b;e.name=a;c.push(e)}return c};chooseAnswerPerson.choosedPersonVal=function(){var b=new Array();if(chooseAnswerPerson.opts.checkType==1){$("#personSearchTbody").find('input[type="radio"]').each(function(){if($(this).is(":checked")){b=chooseAnswerPerson.makeArray($(this).data("rid"),$(this).data("name"),b)}});if(b.length==0){a()}}else{$("#personSearchTbody").find('input[type="checkbox"]').each(function(){if($(this).is(":checked")){b=chooseAnswerPerson.makeArray($(this).data("rid"),$(this).data("name"),b)}});a()}function a(){var f=$.fn.zTree.getZTreeObj("chooseAnswerPersonTree");if(chooseAnswerPerson.opts.checkType==1||chooseAnswerPerson.opts.checkType==2){var e=f.getCheckedNodes(true);if(e.length>chooseAnswerPerson.opts.selectNumber&&chooseAnswerPerson.opts.checkType==2){art.dialog({lock:true,artIcon:"error",opacity:0.4,width:250,title:"报错",content:chooseAnswerPerson.opts.selectPrompt,ok:function(){}});return false}for(var d=0;d<e.length;d++){if(!(e[d].isParent)){b=chooseAnswerPerson.makeArray(e[d].id,e[d].name,b)}}}else{var c=f.getSelectedNodes();if(c.length>0&&!(e[d].isParent)){b=chooseAnswerPerson.makeArray(c[0].id,c[0].name,b)}}}return b};chooseAnswerPerson.artDialog={init:function(){this.obj=art.dialog({artIcon:"add",lock:true,opacity:0.4,width:420,padding:"15px 25px",title:chooseAnswerPerson.opts.artDialogTitle,content:$("#popRespChoo").get(0),init:function(){},ok:function(){if(chooseAnswerPerson.opts.callBack){chooseAnswerPerson.opts.callBack(chooseAnswerPerson.choosedPersonVal())}setTimeout(function(){$("#popRespChoo").find("input.list-search-input").val("").blur();$("#popRespChoo").find(".search-overlay").hide();$("#personSearchTbody").html("")},300)},cancel:true})},obj:null};chooseAnswerPerson.initHtmlWrap=function(){if($("#popRespChoo").length<=0){$("body").append(this.htmlWrap)}};chooseAnswerPerson.removeHtmlWrap=function(){if($("#popRespChoo").length){$("#popRespChoo").remove()}};