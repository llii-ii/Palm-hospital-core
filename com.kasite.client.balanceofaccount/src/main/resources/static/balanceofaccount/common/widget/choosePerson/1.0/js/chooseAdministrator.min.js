var chooseAdministrator=function(a){chooseAdministrator.init(a)};chooseAdministrator.defaults={htmlId:"",parmOrgData:{},artDialogTitle:"\u8bf7\u9009\u62e9\u7ba1\u7406\u4eba",initDataId:null,initDataName:null,ztreeJsonUrl:"",searchJsonUrl:"",checkType:2,selectNumber:10,selectPrompt:"\u6700\u591a\u53ea\u80fd\u9009\u62e9\uff1a",async:false,ztreeFun:{Check:null,AsyncSuccess:null,Click:null},callBack:null};chooseAdministrator.init=function(a){chooseAdministrator.opts=$.extend(this.defaults,a||{});if(chooseAdministrator.opts.async){chooseAdministrator.asyncInit=true}chooseAdministrator.initHtmlWrap();chooseAdministrator.artDialog.init();chooseAdministrator.search();chooseAdministrator.ztreeFun=chooseAdministrator.opts.ztreeFun;chooseAdministrator.ztree(chooseAdministrator.ztreeSetting())};chooseAdministrator.ztree=function(a){if(chooseAdministrator.opts.async){$.fn.zTree.init($("#chooseAdministratorTree"),a)}else{chooseAdministrator.ztreeNodes(a)}};chooseAdministrator.ztreeNodes=function(a){$.ajax({dataType:"json",type:"POST",data:chooseAdministrator.opts.parmOrgData,cache:false,url:chooseAdministrator.opts.ztreeJsonUrl,success:function(b){$.fn.zTree.init($("#chooseAdministratorTree"),a,b);$("#ztreeAdminLoadingTips").hide();chooseAdministrator.ztreeCheckNode(chooseAdministrator.opts.initDataId,false,chooseAdministrator.opts.initDataName)}})};chooseAdministrator.ztreeOnCheck=function(a,c,b){};chooseAdministrator.ztreeOnAsyncSuccess=function(a,c,b,d){$("#ztreeAdminLoadingTips").hide();if(chooseAdministrator.asyncInit){chooseAdministrator.asyncInit=false;chooseAdministrator.ztreeCheckNode(chooseAdministrator.opts.initDataId,false,chooseAdministrator.opts.initDataName)}else{chooseAdministrator.ztreeCheckNode("",false,"")}};chooseAdministrator.ztreeOnClick=function(a,c,b,d){};chooseAdministrator.ztreeFilter=function(c,a,b){return b};chooseAdministrator.orerunDialog=function(){art.dialog({lock:true,artIcon:"error",opacity:0.4,width:250,title:"报错",content:chooseAdministrator.opts.selectPrompt+chooseAdministrator.opts.selectNumber,ok:function(){}})};chooseAdministrator.ztreeCheckNode=function(g,k,d){if(g&&g!=""){var e=$.fn.zTree.getZTreeObj("chooseAdministratorTree");var a=e.transformToArray(e.getNodes()[0].children);var l="",f=new Array(),j={};if(g.indexOf(",")>0){g=g.split(",");d=d.split(",");if($("#adminSelecteBox>li").length+$(g).length>chooseAdministrator.opts.selectNumber){chooseAdministrator.orerunDialog();return false}$(g).each(function(n,i){f=chooseAdministrator.makeArray(i,d[n],f)});for(var h=0;h<a.length;h++){$(g).each(function(n,i){if(i==a[h].id){b(h)}})}}else{if(g!=""){if($("#adminSelecteBox>li").length+1>chooseAdministrator.opts.selectNumber){chooseAdministrator.orerunDialog();return false}f=chooseAdministrator.makeArray(g,d,f);for(var h=0;h<a.length;h++){if(g==a[h].id){b(h)}}}}for(var c=0;c<f.length;c++){if($("#adminSelecteBox>li").length>0){var m=true;for(var o=0;o<$("#adminSelecteBox>li").length;o++){if(f[c].rid==$("#adminSelecteBox>li").eq(o).data("rid")){m=false}}if(m){l+='<li data-rid="'+f[c].rid+'" data-name="'+f[c].name+'"><a href="javascript:;" class="alinks-line alinks-black" onclick="chooseAdministrator.delAdminer(this)">'+f[c].name+"</a></li>"}}else{l+='<li data-rid="'+f[c].rid+'" data-name="'+f[c].name+'"><a href="javascript:;" class="alinks-line alinks-black" onclick="chooseAdministrator.delAdminer(this)">'+f[c].name+"</a></li>"}}$("#adminSelecteBox").append(l)}function b(i){if(k){e.checkNode(a[i],true,true)}else{e.checkNode(a[i],false,true)}}};chooseAdministrator.ztreeSetting=function(){var callbackFun={onCheck:function onCheck(event,treeId,treeNode){if(chooseAdministrator.ztreeFun.Check){eval("chooseAdministrator.ztreeFun.Check(event,treeId, treeNode)")}else{eval("chooseAdministrator.ztreeOnCheck(event,treeId, treeNode)")}},onAsyncSuccess:function onAsyncSuccess(event,treeId,treeNode,msg){if(chooseAdministrator.ztreeFun.AsyncSuccess){eval("chooseAdministrator.ztreeFun.AsyncSuccess(event,treeId, treeNode, msg)")}else{eval("chooseAdministrator.ztreeOnAsyncSuccess(event,treeId, treeNode, msg)")}},onClick:function onClick(event,treeId,treeNode,msg){if(chooseAdministrator.ztreeFun.Click){eval("chooseAdministrator.ztreeFun.Click(event,treeId, treeNode, msg)")}else{eval("chooseAdministrator.ztreeOnClick(event,treeId, treeNode, msg)")}}};if(chooseAdministrator.opts.async){if(chooseAdministrator.opts.checkType==1){var _ztreeSettingVal={async:{enable:true,url:chooseAdministrator.opts.ztreeJsonUrl,autoParam:["id"],otherParam:chooseAdministrator.opts.parmOrgData,dataFilter:chooseAdministrator.ztreeFilter,type:"post"},check:{enable:true,chkStyle:"radio",radioType:"all"},callback:callbackFun}}else{if(chooseAdministrator.opts.checkType==2){var _ztreeSettingVal={async:{enable:true,url:chooseAdministrator.opts.ztreeJsonUrl,autoParam:["id"],otherParam:chooseAdministrator.opts.parmOrgData,dataFilter:chooseAdministrator.ztreeFilter,type:"post"},check:{enable:true},callback:callbackFun}}else{var _ztreeSettingVal={async:{enable:true,url:chooseAdministrator.opts.ztreeJsonUrl,autoParam:["id"],otherParam:chooseAdministrator.opts.parmOrgData,dataFilter:chooseAdministrator.ztreeFilter,type:"post"},callback:callbackFun}}}}else{if(chooseAdministrator.opts.checkType==1){var _ztreeSettingVal={check:{enable:true,chkStyle:"radio",radioType:"all"},callback:callbackFun}}else{if(chooseAdministrator.opts.checkType==2){var _ztreeSettingVal={check:{enable:true},callback:callbackFun}}else{var _ztreeSettingVal={callback:callbackFun}}}}return _ztreeSettingVal};chooseAdministrator.search=function(){$("#popMangChoo").on("focus",".list-search-input",function(){$(this).parent().find(".list-search-clear").show();if(!$(this).parent().next(".search-overlay").is(":visible")){$(this).parent().next(".search-overlay").show()}}).on("blur",".list-search-input",function(){var b=$(this);if(b.val()==""&&$("#adminSearchTbody>tr").length<=0){b.parent().find(".list-search-clear").hide();$(this).parent().next(".search-overlay").hide()}}).on("keyup",".list-search-input",function(c){var b=document.all?window.event:c;if(b.keyCode==13){a($("#popMangChoo").find("input.list-search-input"))}});$("#popMangChoo").on("click",".list-search-icon",function(){a($("#popMangChoo").find("input.list-search-input"))});function a(b){var c=$.trim(b.val());if(c==""){return false}chooseAdministrator.opts.parmOrgData.userName=c;$.ajax({dataType:"json",type:"POST",data:chooseAdministrator.opts.parmOrgData,cache:false,url:chooseAdministrator.opts.searchJsonUrl,success:function(f){var d="";for(var e=0;e<f.Result.length;e++){if(chooseAdministrator.opts.checkType==1){d+='<tr><td><label><input type="radio" class="radio person-search-radio" data-name="'+f.Result[e].CNAME+'" data-rid="'+f.Result[e].USERID+'"></label></td><td class="c-t-center"><span class="c-nowrap">'+f.Result[e].CNAME+'</span></td><td><span class="c-nowrap">'+f.Result[e].JOBNUMBER+'</span></td><td><span class="c-nowrap">'+f.Result[e].ORGNAME+"</span></td></tr>"}else{d+='<tr><td><label><input type="checkbox" class="checkbox person-search-checkbox" data-name="'+f.Result[e].CNAME+'" data-rid="'+f.Result[e].USERID+'"></label></td><td class="c-t-center"><span class="c-nowrap">'+f.Result[e].CNAME+'</span></td><td><span class="c-nowrap">'+f.Result[e].JOBNUMBER+'</span></td><td><span class="c-nowrap">'+f.Result[e].ORGNAME+"</span></td></tr>"}}$("#adminSearchTbody").html(d)}})}$("#popMangChoo").on("click",".list-search-clear",function(){$(this).parent().find("input.list-search-input").val("").blur();$(this).parent().next(".search-overlay").hide();$("#adminSearchTbody").html("")});$("#popMangChoo").on("click","#adminSearchCheckboxAll",function(){if($(this).is(":checked")){$("#adminSearchTbody").find('input[type="checkbox"]').attr("checked","true")}else{$("#adminSearchTbody").find('input[type="checkbox"]').removeAttr("checked")}});$("#popMangChoo").on("click",".person-search-checkbox",function(){var b=true;$(".person-search-checkbox").each(function(){if(!($(this).is(":checked"))){$("#adminSearchCheckboxAll").removeAttr("checked");b=false}});if(b){$("#adminSearchCheckboxAll").attr("checked","true")}})};chooseAdministrator.htmlWrap='<div id="popMangChoo" style="display:none;"><div class="c-main auth-org-w"><div class="clearfix"><div class="fl w420 bgc-fff"><div class="c-border list"><div class="plr15 ptb10 c-f14 c-666 c-border-b c-position-r"><div class="list-search c-position-r searchuser"><input type="text" placeholder="搜索部门人名" class="list-search-input"><i class="iconfont list-search-clear c-hide" title="清空">&#xe635;</i><i class="iconfont list-search-icon" title="搜索">&#xe62c;</i></div><div class="search-overlay"><div class=""><table class="tb width-100"><thead><tr><th><label><input type="checkbox" class="checkbox" id="adminSearchCheckboxAll"></label></th><th>姓名</th><th>工号</th><th>组织名称</th></tr></thead><tbody id="adminSearchTbody"></tbody></table></div></div></div><div class="ptb10" style="height:280px; overflow:auto;"><div class="pt100 c-t-center c-909090 c-f14" id="ztreeAdminLoadingTips">数据正在加载中。。。</div><ul id="chooseAdministratorTree" class="ztree ztree-slack ztree-slack-arrow"></ul></div></div></div><div class="fl add-del-w"><a class="c-btn c-btn-blue" href="javascript:;" onclick="chooseAdministrator.rightShift()">选择右移<em class="c-simsun ml5">&gt;</em></a></div><div class="fl w420 bgc-fff"><div class="c-border list"><div class="plr15 ptb10 c-f14 c-666 c-border-b">选择人员信息</div><div class="ptb10" style="height:280px; overflow:auto;"><ul class="selectedorg c-333" id="adminSelecteBox"></ul></div></div></div></div></div></div>';chooseAdministrator.rightShift=function(){var b=chooseAdministrator.choosedPersonVal(),c="",a="";$(b).each(function(e,d){c+=d.rid+",";a+=d.name+","});c=c.substring(0,c.length-1);a=a.substring(0,a.length-1);chooseAdministrator.ztreeCheckNode(c,false,a)};chooseAdministrator.delAdminer=function(d){var b=$.fn.zTree.getZTreeObj("chooseAdministratorTree");var c=b.transformToArray(b.getNodes()[0].children);idData=$(d).parent().data("rid");for(var a=0;a<c.length;a++){if(idData==c[a].id){b.checkNode(c[a],false,true)}}$(d).parent().remove()};chooseAdministrator.makeArray=function(b,a,c){var d=true;if(c.length>0){$(c).each(function(g,f){if(b==f.rid){d=false}})}if(d){var e=new Array();e.rid=b;e.name=a;c.push(e)}return c};chooseAdministrator.choosedPersonVal=function(){var c=new Array();$("#adminSearchTbody").find('input[type="checkbox"]').each(function(){if($(this).is(":checked")){c=chooseAdministrator.makeArray($(this).data("rid"),$(this).data("name"),c)}});var e=$.fn.zTree.getZTreeObj("chooseAdministratorTree");if(chooseAdministrator.opts.checkType==1||chooseAdministrator.opts.checkType==2){var d=e.getCheckedNodes(true);if(d.length>chooseAdministrator.opts.selectNumber&&chooseAdministrator.opts.checkType==2){chooseAdministrator.orerunDialog();return false}for(var b=0;b<d.length;b++){if(!(d[b].isParent)){c=chooseAdministrator.makeArray(d[b].id,d[b].name,c)}}}else{var a=e.getSelectedNodes();if(a.length>0&&!(d[b].isParent)){c=chooseAdministrator.makeArray(a[0].id,a[0].name,c)}}return c};chooseAdministrator.selectAdminer=function(){var b=new Array(),c=$("#adminSelecteBox>li");for(var a=0;a<c.length;a++){b=chooseAdministrator.makeArray(c.eq(a).data("rid"),c.eq(a).data("name"),b)}return b};chooseAdministrator.artDialog={init:function(){this.obj=art.dialog({artIcon:"add",lock:true,opacity:0.4,width:850,padding:"15px 25px",title:chooseAdministrator.opts.artDialogTitle,content:$("#popMangChoo").get(0),ok:function(){if(chooseAdministrator.opts.callBack){if($("#adminSelecteBox>li").length>0){var a=chooseAdministrator.selectAdminer()}chooseAdministrator.opts.callBack(a)}chooseAdministrator.dialogClose()},cancel:function(){chooseAdministrator.dialogClose()}})},obj:null};chooseAdministrator.dialogClose=function(){setTimeout(function(){$("#adminSelecteBox").html("");$("#popMangChoo").find("input.list-search-input").val("").blur();$("#popMangChoo").find(".search-overlay").hide();$("#adminSearchTbody").html("")},300)};chooseAdministrator.initHtmlWrap=function(){if($("#popMangChoo").length<=0){$("body").append(this.htmlWrap)}};chooseAdministrator.removeHtmlWrap=function(){if($("#popMangChoo").length){$("#popMangChoo").remove()}};