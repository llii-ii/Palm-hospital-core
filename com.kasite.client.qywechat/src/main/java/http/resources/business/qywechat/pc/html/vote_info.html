<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<meta name="skin" content="mes">
		<script src="../js/webCom1.0/base.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="../css/iCheck/custom.css" />
		<title>详情</title>
		<style type="text/css">.nl { line-height: 34px; padding: 0 10px; } ul, li { list-style: none; margin: 0; padding: 0; } .img-list-item { position: relative; float: left; padding-right: 10px; padding-bottom: 5px; } .img-list-addBtn { cursor: pointer; } .img-list-addBtn:after { content: ''; display: block; width: 90px; height: 90px; background: url('../js/webCom1.0/css/skin/yqw/img/addImg2.png'); background-size: 30px 30px; background-position: center; background-repeat: no-repeat; border: 1px dashed #e5e6e7; } .img-list-addBtn input[type="file"] { position: absolute; cursor: pointer; left: 0; top: 0; right: 0; bottom: 0; z-index: 1; opacity: 0; } .img-list-item img { width: 90px; height: 90px; border: 1px solid #e5e6e7; } .addimg { margin-bottom: 5px; } .addimg-has, .addimg-has-text { display: none; } .addimg-no, .addimg-has { position: relative; cursor: pointer; width: 300px; height: 167px; text-align: center; border: 1px dashed #e5e6e7; border-radius: 5px; -webkit-border-radius: 5px; overflow: hidden; } .addimg-has { border: 1px solid #e5e6e7; } .addimg-no input[type="file"], .addimg-has input[type="file"] { cursor: pointer; position: absolute; opacity: 0; left: 0; top: 0; right: 0; bottom: 0; z-index: 2; } .addimg-no img { width: 40px; margin: 30px auto 10px auto; display: block; } .addimg-has img { display: block; width: 100%; height: 100%; } .addimg-no span, .addimg-has-text span { font-size: 16px; font-weight: bold; margin-bottom: 5px; display: block; } .addimg-no p, .addimg-has-text p { color: #e5e6e7; } .addimg.active .addimg-has, .addimg.active .addimg-has-text { display: block; } .addimg.active .addimg-no { display: none; } .form-control { margin-bottom: 5px; }</style></head>
	<body class="children-page">
		<div class="form-inline" style="max-width: 600px;">
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>
						<span class="red">*</span>参与人员：</label></div>
				<div class="x-row-cols " style="margin-left:140px;">
					<input id="parter" type="text" value="" class="form-control" placeholder="请选择" readOnly="true">
					<input id="checksId" type="hidden" value="">
					<input id="checksName" type="hidden" value="">
					<input id="checksId_old" type="hidden" value="">
					<input id="checksName_old" type="hidden" value="">
					<input id="uid" type="hidden" value="">
					<input id="id" type="hidden" value=""></div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label id="titleLabel">
						<span class="red">*</span>投票标题：</label></div>
				<div class="x-row-cols " style="margin-left:140px;">
					<input type="text" id="title" class="form-control" value="" readOnly="true" /></div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>封面图片：</label></div>
				<div class="x-row-cols " style="margin-left:140px;">
					<input type="hidden" id="attachmentUrl" name="attachmentUrl" value="" />
					<input type="hidden" id="attachmentName" name="attachmentUrl" value="" />
					<input type="hidden" id="attachmentUrl_old" name="attachmentUrl_old" value="" />
					<input type="hidden" id="attachmentName_old" name="attachmentUrl_old" value="" />
					<div class="addimg">
						<div class="addimg-no">
							<input type="file" name="newsFile" id="attachment" onclick="return false;" accept="image/jpg,image/png" value="" />
							<img id="imgView" src="../js/webCom1.0/css/skin/yqw/img/addImg.png" />
							<span>点击上传图片</span>
							<p>建议使用900x500像素的图片</p>
						</div>
					</div>
				</div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>首语：</label></div>
				<div class="x-row-cols " style="margin-left:140px;">
					<textarea readOnly="true" name="beginintro" id="beginintro" rows="5" style="width: 100%;resize: none;" class="form-control" cols=""></textarea>
				</div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>尾语：</label></div>
				<div class="x-row-cols " style="margin-left:140px;">
					<textarea readOnly="true" name="endingintro" id="endingintro" rows="5" style="width: 100%;resize: none;" class="form-control" cols=""></textarea>
				</div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>
						<span class="red">*</span>截至日期：</label></div>
				<div class="x-row-cols " style="margin-left:140px;">
					<input disabled="true" type="text" id="endtime" component="dateTime" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'})" class="form-control" value="" /></div>
			</div>
		</div>
		<div class="form-inline" style="min-width: 100%;">
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>
						<span class="red">*</span>题目类型：</label></div>
				<input type="hidden" id="themeId" value="" />
				<div class="x-row-cols " style="margin-left:140px;">
					<div style="padding-top: 8px;">
						<div class="radio i-checks">
							<label>
								<input type="radio" value="0" name="questType" readOnly="true" />单选</label></div>
						<div class="radio i-checks">
							<label>
								<input type="radio" value="1" name="questType" readOnly="true" />多选</label></div>
						<div class="radio i-checks">
							<label>
								<input type="radio" value="2" name="questType" readOnly="true" />问答</label></div>
						<div class="radio i-checks">
							<label>
								<input type="radio" value="3" name="questType" readOnly="true" />打分</label></div>
					</div>
				</div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>
						<span class="red">*</span>题目标题：</label></div>
				<div class="x-row-cols text-right" style="width: 400px;">
					<input type="text" class="form-control" name="questName" id="questName" value="" readOnly="true" /></div>
				<div class="x-row-cols " style="margin-left:540px;">
					<span class="nl">0/200</span></div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>
						<span class="red">*</span>题目选项：</label></div>
				<div class="x-row-cols" style="width: 280px;">
					<input type="text" class="form-control" name="item" id="item_0" value="" readOnly="true" /></div>
				<div class="x-row-cols" style="width: 70px;">
					<span class="nl">0/200</span></div>
				<div class="x-row-cols " style="margin-left:490px;">
					<!--<button type="button" class="btn btn-info"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加图片</button>-->
					<button type="button" onclick="del(this)" class="btn btn-danger" readOnly="true">
						<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
					</button>
				</div>
			</div>
			<div class="x-row addBtn" id="addBtn">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label></label>
				</div>
				<div class="x-row-cols" style="margin-left:140px;">
					<button type="button" onclick="addItem('')" style="width: 280px;margin-bottom: 8px;" class="btn btn-primary" readOnly="true">
						<span class="glyphicon glyphicon-plus" aria-hidden="true" readOnly="true"></span>添加选项</button>
				</div>
			</div>
			<div class="x-row">
				<div class="x-row-cols text-right" style="width: 140px;">
					<label>
						<span class="red">*</span>是否必答：</label></div>
				<div class="x-row-cols " style="margin-left:140px;">
					<div style="padding-top: 8px;">
						<div class="radio i-checks">
							<label>
								<input type="radio" checked="" value="0" name="isMust" readOnly="true">
								<i>
								</i>必答</label>
						</div>
						<div class="radio i-checks">
							<label>
								<input type="radio" value="1" name="isMust" readOnly="true">
								<i>
								</i>选答</label>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="form-inline" style="max-width: 600px;">
			<div class="x-row">
				<div class="x-row-cols " style="width: 140px;">
					<label></label>
				</div>
				<div class="x-row-cols " style="margin-left:140px;padding-top: 8px;">
					<button type="button" class="btn btn-w-m btn-primary" onclick="updateVote(1,true)">发布</button>
					<button type="button" class="btn btn-w-m btn-info" onclick="updateVote(0,false)">预览</button>
					<button type="button" class="btn btn-w-m btn-border" onclick="updateVote(0,true)">存为草稿</button></div>
			</div>
		</div>
		<br />
		<br />
		<br /></body>
	<script src="../../pc/js/jquery-1.9.1.min.js"></script>
	<script src="../js/webCom1.0/component/table/js/bootstrap-table.js"></script>
	<script src="../js/webCom1.0/component/table/js/bootstrap-table-zh-CN.js"></script>
	<script type="text/javascript" src="../../common/js/base.js"></script>
	<script type="text/javascript" src="../../common/js/common.js"></script>
	<script type="text/javascript" src="../js/webCom1.0/component/dateTime/My97DatePicker/WdatePicker.js"></script>
	<script type="text/javascript" src="../../../../module/backstage/commons/upload/upload.js"></script>
	<script src="../js/iCheck/icheck.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">var id;
		var questId;
		$(function() {
			id = Commonjs.getUrlParam("id");
			getVoteById(id);

			$('.i-checks').iCheck({
				checkboxClass: 'icheckbox_square-green',
				radioClass: 'iradio_square-green',
			});

			$("input[name='questType']").iCheck('disable');
			$("input[name='isMust']").iCheck('disable');
			$('input').attr("disabled", "disabled");
			$('button').attr("disabled", true);

		});

		//根据ID获取投票信息
		function getVoteById(id) {
			if (Commonjs.isEmpty(id)) {
				alert("投票ID不能为空！");
				return;
			}

			var apiData = {};
			apiData.id = id;
			var param = {};
			param.apiParam = Commonjs.getApiReqParams(apiData);
			Commonjs.ajax('/wsgw/qyWeChat/GetVoteQuestionInfoById/callApi.do', param,
			function(dd) {
				console.log("dd.RespCode=");
				if (dd.RespCode == 10000) {
					if (dd.Data.length > 0) {
						var result = dd.Data[0];
						$("#id").val(result.Id);
						$("#uid").val(result.Uid);
						$("#parter").val(result.MemberNames);
						$("#checksId").val(result.MemberIds);
						$("#checksName").val(result.MemberNames);
						//旧成员
						$("#checksId_old").val(result.MemberIds);
						$("#checksName_old").val(result.MemberNames);
						$("#title").val(result.Title);
						//空时 显示上传图片
						if (!Commonjs.isEmpty(result.AttachmentUrl)) {
							//展示图片
							$("#imgView").attr("src", result.AttachmentUrl);
							$("#imgView").css("width", "300px");
							$("#imgView").css("height", "167px");
							//保存文件名和URL
							$("#attachmentUrl").val(result.AttachmentUrl);
							$("#attachmentName").val(result.AttachmentName);
							//旧附件
							$("#attachmentUrl_old").val(result.AttachmentUrl);
							$("#attachmentName_old").val(result.AttachmentName);
						}
						$("#beginintro").val(result.BeginIntro);
						$("#endingintro").val(result.EndingIntro);
						$("#endtime").val(result.EndTime);
						//查询问题列表
						console.log("uid=" + result.Uid);
						//GetQuestionList(result.Uid);
						getQuestionById(result.Uid);
					}
				} else {
					alert(dd.RespMessage);
				}
			});
		}

		//预览
		function view() {
			var apiData = {};
			apiData.id = id;
			apiData.qyClientId = Commonjs.getQyWeChatClientId();
			apiData.qyConfigKey = Commonjs.getQyWeChatConfigKey('TPGL');
			var param = {};
			param.apiParam = Commonjs.getApiReqParams(apiData);
			Commonjs.ajax('/wsgw/qyWeChat/GetVoteQuestionQRCode/callApi.do', param,
			function(dd) {
				if (dd.RespCode == 10000) {
					showQRcode(dd.Data[0].QrPicUrl);
				} else {
					alert(dd.RespMessage);
				}
			});
		}

		//展示二维码
		function showQRcode(qrPicUrl) {
			System.openWindow({
				id: 'votequestionQRcode2',
				title: '请使用企业微信扫码预览',
				url: qrPicUrl,
				width: '400',
				height: '450',
				maxmin: false,
				onload: function() {

},
				closed: function() {

}
			});
		}

		//获取问题详情
		function getQuestionById(id) {
			if (Commonjs.isEmpty(id)) {
				alert("问题ID不能为空！");
				return;
			}
			var apiData = {};
			apiData.id = id;
			apiData.tag = "uid";
			var param = {};
			param.apiParam = Commonjs.getApiReqParams(apiData);
			Commonjs.ajax('/wsgw/qyWeChat/GetQuestionById/callApi.do', param,
			function(dd) {
				if (dd.RespCode == 10000) {
					if (dd.Data.length > 0) {
						var result = dd.Data[0];
						console.log(result);
						$("#themeId").val(result.Themeid);
						$("input[name='questType'][value='" + result.Questtype + "']").iCheck('check');
						$("input[name='isMust'][value='" + result.Ismust + "']").iCheck('check');
						$("#questName").val(result.Questname);
						questId = result.Id;
						getQuestionItemByQuestionId(result.Id, result.Questtype);
					}
				} else {
					alert(dd.RespMessage);
				}
			});
		}

		//获取问题选项列表
		function getQuestionItemByQuestionId(questionId, questtype) {
			if (Commonjs.isEmpty(questionId)) {
				alert("问题ID不能为空！");
				return;
			}
			var apiData = {};
			apiData.id = questionId;
			var param = {};
			param.apiParam = Commonjs.getApiReqParams(apiData);
			Commonjs.ajax('/wsgw/qyWeChat/GetQuestionItemList/callApi.do', param,
			function(dd) {
				if (dd.RespCode == 10000) {
					if (Commonjs.ListIsNotNull(dd.Data)) {
						//移除默认的
						$("input[id='item_0']").parents('.x-row').remove();
						Commonjs.BaseForeach(dd.Data,
						function(i, item) {
							console.log(item);
							if (questtype == 0 || questtype == 1) {
								addItem(item.Itemvalue);
							}
						});
					}
				} else {
					alert(dd.RespMessage);
				}
			});
		}</script>

</html>